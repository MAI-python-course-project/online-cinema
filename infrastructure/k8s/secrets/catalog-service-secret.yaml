# WARNING: This is an example file. In production:
# 1. Use sealed-secrets or external-secrets-operator
# 2. Store secrets in Vault, AWS Secrets Manager, or GCP Secret Manager
# 3. Never commit actual secrets to Git
# 4. Use RBAC to restrict access to secrets

apiVersion: v1
kind: Secret
metadata:
  name: catalog-service-secrets
  namespace: cinema
  labels:
    app: catalog-service
type: Opaque
stringData:
  # Database
  # Format: postgresql://user:password@host:port/database
  database-url: "postgresql://cinema:CHANGE_ME_IN_PRODUCTION@postgres:5432/catalog"

  # Redis
  # Format: redis://[:password@]host:port/db
  redis-url: "redis://:CHANGE_ME_IN_PRODUCTION@redis:6379/2"

  # MinIO/S3
  minio-access-key: "CHANGE_ME_IN_PRODUCTION"
  minio-secret-key: "CHANGE_ME_IN_PRODUCTION"

  # JWT (if needed)
  jwt-secret: "CHANGE_ME_IN_PRODUCTION_VERY_LONG_RANDOM_STRING"

---
# External Secrets Operator example
# Requires external-secrets-operator to be installed
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: catalog-service-external-secrets
  namespace: cinema
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore

  target:
    name: catalog-service-secrets-from-aws
    creationPolicy: Owner

  data:
    - secretKey: database-url
      remoteRef:
        key: cinema/catalog-service/database-url

    - secretKey: redis-url
      remoteRef:
        key: cinema/catalog-service/redis-url

    - secretKey: minio-access-key
      remoteRef:
        key: cinema/catalog-service/minio-access-key

    - secretKey: minio-secret-key
      remoteRef:
        key: cinema/catalog-service/minio-secret-key

---
# Sealed Secret example
# Requires sealed-secrets controller to be installed
# Generate with: kubeseal -f secret.yaml -w sealed-secret.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: catalog-service-sealed-secrets
  namespace: cinema
spec:
  encryptedData:
    database-url: AgBR... # Encrypted value
    redis-url: AgCT...    # Encrypted value
  template:
    metadata:
      name: catalog-service-secrets-sealed
      namespace: cinema
    type: Opaque
